{"version":3,"file":"compository-service.js","sourceRoot":"","sources":["../../src/services/compository-service.ts"],"names":[],"mappings":"AACA,OAAO,EAAE,kBAAkB,EAAE,MAAM,kCAAkC,CAAC;AAOtE,OAAO,KAAK,OAAO,MAAM,kBAAkB,CAAC;AAQ5C,MAAM,OAAO,kBAAmB,SAAQ,kBAAkB;IACxD,YACS,cAA8B,EAC9B,YAA0B,EAC1B,MAAc;QAErB,KAAK,CAAC,YAAY,EAAE,MAAM,EAAE,cAAc,CAAC,CAAC;QAJrC,mBAAc,GAAd,cAAc,CAAgB;QAC9B,iBAAY,GAAZ,YAAY,CAAc;QAC1B,WAAM,GAAN,MAAM,CAAQ;IAGvB,CAAC;IAED,cAAc;IAEd,KAAK,CAAC,iBAAiB,CAAC,OAAe;QACrC,MAAM,MAAM,GAAG,MAAM,IAAI,CAAC,QAAQ,CAChC,aAAa,EACb,sBAAsB,EACtB,OAAO,CACR,CAAC;QACF,MAAM,CAAC,UAAU,GAAG,OAAO,CAAC,MAAM,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC;QACtD,OAAO,MAAM,CAAC;IAChB,CAAC;IAED,UAAU,CACR,IAAU,EACV,UAE8D;QAE9D,OAAO,KAAK,CAAC,UAAU,CAAC,IAAI,EAAE,UAAU,EAAE,EAAE,GAAG,IAAI,GAAG,IAAI,CAAC,CAAC;IAC9D,CAAC;IAED,KAAK,CAAC,UAAU,CAAC,WAAmB;QAClC,OAAO,IAAI,CAAC,QAAQ,CAAC,aAAa,EAAE,cAAc,EAAE,WAAW,CAAC,CAAC;IACnE,CAAC;IACD,KAAK,CAAC,cAAc,CAAC,eAAuB;QAC1C,OAAO,IAAI,CAAC,QAAQ,CAAC,aAAa,EAAE,kBAAkB,EAAE,eAAe,CAAC,CAAC;IAC3E,CAAC;IAED,KAAK,CAAC,cAAc;QAClB,OAAO,IAAI,CAAC,QAAQ,CAAC,aAAa,EAAE,mBAAmB,EAAE,IAAI,CAAC,CAAC;IACjE,CAAC;IAED,KAAK,CAAC,sBAAsB;QAC1B,OAAO,IAAI,CAAC,QAAQ,CAAC,aAAa,EAAE,2BAA2B,EAAE,IAAI,CAAC,CAAC;IACzE,CAAC;IAED,eAAe;IAEf,KAAK,CAAC,WAAW,CAAC,OAAgB;QAChC,OAAO,IAAI,CAAC,QAAQ,CAAC,aAAa,EAAE,cAAc,EAAE,OAAO,CAAC,CAAC;IAC/D,CAAC;IACD,KAAK,CAAC,kBAAkB,CAAC,WAAwB;QAC/C,OAAO,IAAI,CAAC,QAAQ,CAAC,aAAa,EAAE,sBAAsB,EAAE,WAAW,CAAC,CAAC;IAC3E,CAAC;IACD,KAAK,CAAC,sBAAsB,CAC1B,KAAkC;QAElC,KAAK,CAAC,UAAU,GAAG,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,UAAU,CAAC,CAAC;QACpD,OAAO,IAAI,CAAC,QAAQ,CAAC,aAAa,EAAE,0BAA0B,EAAE,KAAK,CAAC,CAAC;IACzE,CAAC;IAEO,QAAQ,CAAC,IAAY,EAAE,MAAc,EAAE,OAAY;QACzD,OAAO,IAAI,CAAC,YAAY,CAAC,QAAQ,CAAC;YAChC,GAAG,EAAE,IAAI;YACT,OAAO,EAAE,IAAI,CAAC,MAAM;YACpB,OAAO,EAAE,MAAM;YACf,OAAO,EAAE,OAAO;YAChB,UAAU,EAAE,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC;YAC1B,SAAS,EAAE,IAAI;SAChB,CAAC,CAAC;IACL,CAAC;CACF","sourcesContent":["import { AdminWebsocket, AppWebsocket, CellId } from '@holochain/conductor-api';\nimport { FileStorageService } from '@holochain-open-dev/file-storage';\nimport {\n  DnaTemplate,\n  PublishInstantiatedDnaInput,\n  ZomeDef,\n} from '../types/dnas';\nimport { HoloHashed } from '@holochain-open-dev/core-types';\nimport * as msgpack from '@msgpack/msgpack';\n\nexport interface GetTemplateForDnaOutput {\n  dnaTemplate: DnaTemplate;\n  properties: any;\n  uuid: string;\n}\n\nexport class CompositoryService extends FileStorageService {\n  constructor(\n    public adminWebsocket: AdminWebsocket,\n    public appWebsocket: AppWebsocket,\n    public cellId: CellId\n  ) {\n    super(appWebsocket, cellId, 'file_storage');\n  }\n\n  /** Getters */\n\n  async getTemplateForDna(dnaHash: string): Promise<GetTemplateForDnaOutput> {\n    const result = await this.callZome(\n      'compository',\n      'get_template_for_dna',\n      dnaHash\n    );\n    result.properties = msgpack.decode(result.properties);\n    return result;\n  }\n  \n  uploadFile(\n    file: File,\n    onProgress?:\n      | undefined\n      | ((percentatgeProgress: number, bytesSent: number) => void)\n  ): Promise<string> {\n    return super.uploadFile(file, onProgress, 10 * 1024 * 1024);\n  }\n\n  async getZomeDef(zomeDefHash: string): Promise<ZomeDef> {\n    return this.callZome('compository', 'get_zome_def', zomeDefHash);\n  }\n  async getDnaTemplate(dnaTemplateHash: string): Promise<DnaTemplate> {\n    return this.callZome('compository', 'get_dna_template', dnaTemplateHash);\n  }\n\n  async getAllZomeDefs(): Promise<Array<HoloHashed<ZomeDef>>> {\n    return this.callZome('compository', 'get_all_zome_defs', null);\n  }\n\n  async getAllInstantiatedDnas(): Promise<Array<string>> {\n    return this.callZome('compository', 'get_all_instantiated_dnas', null);\n  }\n\n  /** Creators */\n\n  async publishZome(zomeDef: ZomeDef): Promise<string> {\n    return this.callZome('compository', 'publish_zome', zomeDef);\n  }\n  async publishDnaTemplate(dnaTemplate: DnaTemplate): Promise<string> {\n    return this.callZome('compository', 'publish_dna_template', dnaTemplate);\n  }\n  async publishInstantiatedDna(\n    input: PublishInstantiatedDnaInput\n  ): Promise<string> {\n    input.properties = msgpack.encode(input.properties);\n    return this.callZome('compository', 'publish_instantiated_dna', input);\n  }\n\n  private callZome(zome: string, fnName: string, payload: any) {\n    return this.appWebsocket.callZome({\n      cap: null,\n      cell_id: this.cellId,\n      fn_name: fnName,\n      payload: payload,\n      provenance: this.cellId[1],\n      zome_name: zome,\n    });\n  }\n}\n"]}